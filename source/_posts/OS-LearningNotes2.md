---
title: 从开机加电到执行main函数之前的过程
date: 2022-09-06 14:07:10
tags: 
  - 操作系统
  - Linux Kernel
  - BIOS
categories: 操作系统高级教程课堂笔记
description: 国科大杨力祥《操作系统高级教程》课堂笔记3 —— 开机加电后的过程
cover: https://s3.bmp.ovh/imgs/2022/08/30/57e6003529c041b7.webp
---

# 引言
从开机加电到执行main函数之前，主要分为以下三个部分：
1. 启动BIOS，准备实模式下的中断向量表和中断服务程序
2. 从启动盘加载操作系统程序到内存
  - bootsect程序（扇区 -> 主机内存）
  - setup程序（设置内核运行所需的机器系统数据）
  - head程序（保护模式，内存分页）
3. 为执行32位的main函数做过渡

# 启动BIOS
1. CPU的硬件都设置为加电进入实模式
2. BIOS程序被固化在ROM中，由硬件方式执行：加电瞬间，CS:IP指向BIOS程序的入口地址（0xFFFF0）
3. BIOS检测显卡、内存……，并且**在内存中建立中断向量表和中断服务程序**

> - ROM:只读存储器，断电之后仍能保存信息
> - 0x00400 = 4*(16^2)字节 = 4*256字节 = 1024字节 = 1KB

# 加载操作系统内核程序
## 加载内核引导程序bootsect
**理解**： bootsect中sect是section的缩写，代表软盘。整个bootsect程序就是将内核程序从软盘加载到主机内存的过程。
**过程**：
1. CPU接收到一个int 0x19中断
2. 对应中断服务程序把软盘中第一扇区的程序（512B）加载到内存的指定位置（0x07C00）

> 冷知识：0x07C00来自Intel第一台个人电脑8088芯片，为了保持兼容，以后的CPU都保留此地址
## 加载内核程序setup
BIOS将引导程序bootsect载入内存后，现在需要将
## 加载内核程序head
## 